# Проектная работа "Веб-ларек"

# Описание проекта
WebLarek - это современное одностраничное приложение (SPA) интернет-магазина электроники, построенное на TypeScript с использованием архитектурного паттерна MVP (Model-View-Presenter). Приложение предоставляет полный цикл покупки: просмотр каталога товаров, детальный просмотр товаров, управление корзиной и оформление заказа.

# Стек: 
1. HTML5 - семантическая разметка и структура приложения
2. SCSS - препроцессор CSS для стилизации компонентов
3. TypeScript - статическая типизация и ООП подход
4. Webpack - сборка и бандлинг приложения
5. ООП - объектно-ориентированное программирование


## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

npm install

npm run start

## Сборка
npm run build

# Описание архитектуры проекта

## Подход разработки
Проект использует событийно-ориентированный подход в сочетании с архитектурным паттерном MVP:
- Событийно-ориентированный подход: Все взаимодействия между компонентами осуществляются через обмен сообщениями с помощью центрального EventEmitter
- MVP (Model-View-Presenter): Четкое разделение ответственности между компонентами

## Базовый код

EventEmitter - **Центральная шина событий
**Назначение: Управление событиями и коммуникацией между компонентами

**Основные методы:
- on(eventName, callback) - Подписка на событие
- off(eventName, callback) - Отписка от события
- emit(eventName, data) - Генерация события

**Ключевые события:
- cart:changed - Изменение состояния корзины
- cart:open - Открытие корзины
- order:open - Открытие формы заказа
- product:open - Открытие детального просмотра товара
- cart:action - Действие с товаром (добавить/удалить)

Api - **Базовый HTTP клиент
**Назначение: Абстракция для работы с сетевыми запросами

**Конструктор:
- baseUrl: string - Базовый URL API
- options: RequestInit - Опции HTTP запросов

**Методы:
- get<T>(uri) - GET запрос
- post<T>(uri, data, method) - POST/PUT/DELETE запрос
- handleResponse<T>(response) - Обработка ответов сервера

## Компоненты модели данных (Model)

CartModel - **Модель корзины покупок
**Назначение: Управление состоянием корзины, бизнес-логика работы с товарами

**Поля:
- items: Product[] - Массив товаров в корзине

**Основные методы:
- add(item: Product) - Добавляет товар в корзину, если его там нет. Сохраняет в localStorage и генерирует событие cart:changed
- remove(itemId: string) - Удаляет товар из корзины по ID. Обновляет localStorage и уведомляет о changes
- clear() - Полностью очищает корзину. Используется при обновлении страницы и после успешного заказа
- getItems(): string[] - Возвращает массив ID товаров для отправки на сервер
- getProducts(): Product[] - Возвращает полные данные товаров для отображения в корзине
- getTotal(): number - Вычисляет общую стоимость всех товаров в корзине
- hasItem(itemId): boolean - Проверяет наличие товара в корзине для обновления UI
- getItemCount(): number - Возвращает количество товаров для счетчика в header

OrderModel - **Модель заказа
**Назначение: Валидация и хранение данных заказа

**Поля:
- payment: PaymentType - Способ оплаты (ONLINE/CASH)
- address: string - Адрес доставки
- email: string - Email покупателя
- phone: string - Телефон покупателя
- items: string[] - ID товаров в заказе
- total: number - Общая сумма заказа

**Методы:
- validateStep1(): ValidationErrors - Проверяет корректность оплаты и адреса перед переходом к контактам
- validateStep2(): ValidationErrors - Валидирует email и телефон перед отправкой на сервер
- reset() - Сбрасывает все данные заказа после успешного оформления или отмены

DataApi - **API клиент
**Назначение: Работа с backend API

**Методы:
- getItems(): Promise<{ items: ApiProduct[] }> - Получение списка товаров
- getItem(id: string): Promise<ApiProduct> - Получение конкретного товара
- sendOrder(data: Order): Promise<{ id: string }> - Отправка заказа

## Компоненты представления (View)

ItemView - **Карточка товара в каталоге
**Назначение: Отображение товара в основном каталоге

**Поля:
- element: HTMLElement - DOM элемент карточки товара
- image: HTMLImageElement - Элемент изображения товара
- title: HTMLElement - Элемент названия товара
- category: HTMLElement - Элемент категории товара
- price: HTMLElement - Элемент цены товара
- product: Product - Данные отображаемого товара
- modalHandler: Function - Обработчик открытия модального окна

**Методы:
- render(data) - Отрисовывает карточку товара с переданными данными. Устанавливает изображение, текст, цены и классы категорий
- setModalHandler(handler) - Устанавливает обработчик клика по карточке для открытия детального просмотра

CartView - **Представление корзины
**Назначение: Отображение содержимого корзины и управление им

**Поля:
- element: HTMLElement - Основной контейнер
- list: HTMLElement - Список товаров
- totalElement: HTMLElement - Элемент общей суммы
- checkoutButton: HTMLButtonElement - Кнопка оформления заказа
- actionHandler: Function - Обработчик действий с товарами

**Методы:
- render(data) - Отрисовывает корзину с товарами. Очищает список, добавляет товары, обновляет сумму, управляет состоянием кнопки оформления
- setCheckoutHandler(handler) - Устанавливает обработчик клика на кнопку оформления заказа
- setActionHandler(handler) - Настраивает обработчик удаления товаров из корзины через делегирование событий


ProductModalView - **Модальное окно товара
**Назначение: Детальное отображение товара с возможностью добавления в корзину

**Поля:
- element: HTMLElement - Контейнер модального окна
- image: HTMLImageElement - Изображение товара высокого качества
- title: HTMLElement - Полное название товара
- category: HTMLElement - Категория с цветовым coding
- description: HTMLElement - Подробное описание товара
- price: HTMLElement - Цена с валютой
- button: HTMLButtonElement - Интерактивная кнопка действия
- currentProduct: Product - Текущий отображаемый товар
- actionHandler: Function - Обработчик действий с товаром

**Методы:
- render(data) - Заполняет модальное окно данными товара. Управляет состоянием кнопки (Купить/Убрать/Не продается)
- setActionHandler(handler) - Устанавливает обработчик для кнопки действия с товаром
- setCloseHandler(handler) - Обработчик закрытия окна
- updateCartState(isInCart) - Обновление состояния кнопки

ModalView - **Управление модальными окнами
**Назначение: Контроль отображения и скрытия модальных окон

**Поля:
- modal: HTMLElement - DOM элемент модального окна
- content: HTMLElement - Контейнер для контента
- closeButton: HTMLButtonElement - Кнопка закрытия

**Методы:
- open(content) - Открытие модального окна с контентом
- close() - Закрытие модального окна
- isOpen(): boolean - Проверка состояния окна

OrderFormView - **Форма оформления заказа (шаг 1)
**Назначение: Ввод данных оплаты и адреса доставки

**Поля:
- onlineButton: HTMLButtonElement - Кнопка онлайн-оплаты
- cashButton: HTMLButtonElement - Кнопка оплаты при получении
- addressInput: HTMLInputElement - Поле адреса
- nextButton: HTMLButtonElement - Кнопка продолжения

**Методы:
- render(data) - Рендеринг формы
- setSubmitHandler(handler) - Обработчик отправки формы
- setNextHandler(handler) - Обработчик перехода к следующему шагу
- showErrors(errors) - Отображение ошибок валидации

ContactsFormView - **Форма контактов (шаг 2)
**Назначение: Ввод контактных данных покупателя

**Поля:
- emailInput: HTMLInputElement - Поле email
- phoneInput: HTMLInputElement - Поле телефона
- submitButton: HTMLButtonElement - Кнопка отправки

**Методы:
- render(data) - Рендеринг формы
- setSubmitHandler(handler) - Обработчик отправки формы
- setBackHandler(handler) - Обработчик возврата к предыдущему шагу
- showErrors(errors) - Отображение ошибок валидации

SuccessWindowView - **Окно успешного оформления
**Назначение: Отображение подтверждения успешного оформления заказа

**Поля:
- descriptionElement: HTMLElement - Описание с суммой заказа
- closeButton: HTMLButtonElement - Кнопка закрытия

**Методы:
- render(data) - Рендеринг окна успеха
- setContinueHandler(handler) - Обработчик продолжения покупок

## Presenter (index.ts)
**Назначение: Главный координатор, связывающий все компоненты приложения

**Основа:
- Инициализация всех компонентов при загрузке страницы
- Настройка обработчиков событий и связей между компонентами
- Координация взаимодействия между View и Model
- Обработка пользовательских действий и бизнес-логики
- Управление состоянием приложения

**Ключевые функции:
- loadProducts() - Загрузка товаров из API
- updateCartCounter() - Обновление счетчика корзины
- submitOrder() - Отправка заказа на сервер
- Обработчики всех событий EventEmitter

## Типы данных

Product - **Основной интерфейс товара

```interface Product {
    id: string;           // Уникальный идентификатор
    title: string;        // Название товара
    description: string;  // Описание товара
    price: number | null; // Цена (null для бесценных товаров)
    image: string;        // URL изображения
    category: string;     // Категория товара
  }

ApiProduct - **Товар из API

``` interface ApiProduct {
  id: string;
  title: string;
  description: string;
  price: number;        // Всегда число (не null)
  image: string;        // Относительный путь
  category: string;
}

Order - **Данные заказа

```interface Order {
  payment: PaymentType; // ONLINE или CASH
  address: string;      // Адрес доставки
  email: string;        // Email покупателя
  phone: string;        // Телефон покупателя
  items: string[];      // Массив ID товаров
  total: number;        // Общая сумма
}

PaymentType - **Enum способов оплаты

```enum PaymentType {
  ONLINE = 'online',    // Онлайн-оплата
  CASH = 'cash'         // Оплата при получении
}

ValidationErrors - **Ошибки валидации

```interface ValidationErrors {
  payment?: string;     // Ошибка способа оплаты
  address?: string;     // Ошибка адреса
  email?: string;       // Ошибка email
  phone?: string;       // Ошибка телефона
}

## Взаимодействие компонентов

## Последовательность добавления товара в корзину:
1. Пользователь кликает на карточку товара в каталоге
2. ItemView генерирует событие product:open с данными товара
3. Presenter перехватывает событие и открывает ProductModalView
4. ProductModalView рендерит детальную информацию о товаре
5. Пользователь кликает "Купить" в модальном окне
6. ProductModalView генерирует событие cart:action с action: 'add'
7. Presenter обрабатывает событие и вызывает CartModel.add()
8. CartModel обновляет состояние и генерирует cart:changed
9. Presenter обновляет все зависимые View (счетчик, кнопки)

## Последовательность оформления заказа:
1. Пользователь кликает на иконку корзины
2. Header генерирует событие cart:open
3. Presenter открывает CartView с текущими товарами
4. Пользователь кликает "Оформить заказ" в корзине
5. CartView генерирует событие order:open
6. Presenter открывает OrderFormView (шаг 1)
7. Пользователь заполняет данные оплаты и адреса
8. OrderFormView валидирует данные и генерирует order:next
9. Presenter открывает ContactsFormView (шаг 2)
10. Пользователь заполняет контактные данные
11. ContactsFormView валидирует и генерирует order:submit
12. Presenter отправляет заказ через DataApi.sendOrder()
13. При успехе открывается SuccessWindowView

## Архитектурные паттерны
## MVP (Model-View-Presenter)

1. Model (CartModel, OrderModel) - Данные и бизнес-логика
2. View (Все *View компоненты) - Отображение и пользовательский ввод
3. Presenter (index.ts) - Посредник между Model и View

## Event-Driven Architecture
Все компоненты общаются через центральный EventEmitter, что обеспечивает:

1. Слабое связывание компонентов
2. Легкую тестируемость каждого компонента отдельно
3. Простую расширяемость - новые функции добавляются через события

## Singleton Pattern
Ключевые компоненты создаются один раз и переиспользуются:
1. ModalView - управление всеми модальными окнами
2. Представления корзины, форм, успеха
4. Модели данных

## Ключевые особенности реализации
## Type Safety
Полная типизация на TypeScript обеспечивает:
- Обнаружение ошибок на этапе компиляции
- Автодополнение в IDE
- Самодокументируемость кода

## Separation of Concerns
Четкое разделение ответственности:
- Модели - только данные и бизнес-логика
- Представления - только отображение и DOM операции
- Presenter - только координация и обработка событий

## No Direct DOM Manipulation
Все DOM операции изолированы в классах View:
- Поиск элементов через ensureElement утилиты
- Изменение стилей и контента через методы View
- Обработчики событий устанавливаются в конструкторах View

## Single Responsibility Principle
Каждый компонент решает строго одну задачу:
- ItemView - отображение карточки товара
- CartView - отображение корзины
- ProductModalView - детальный просмотр товара
- Каждая модель отвечает за свой сегмент данных